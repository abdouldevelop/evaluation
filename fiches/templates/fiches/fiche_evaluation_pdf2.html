<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>FICHE D’ÉVALUATION DES AGENTS</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        @page {
            size: A4;
            margin: 5mm 1mm 10mm 1mm; /* Marges latérales à 10mm */
        }
        body {
            font-family: 'Montserrat', Arial, Helvetica, sans-serif;
            font-size: 12pt;
            line-height: 1.6;
            color: #000;
            margin: 0;
        }
        .container {
            max-width: 190mm; /* Largeur utile augmentée à 190mm */
            margin: 0 auto;
            padding: 0;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        .header img {
            width: 100%;
            height: auto;
            max-height: 150px; /* En-tête agrandi */
        }
        h1 {
            font-size: 16pt;
            font-weight: bold;
            text-transform: uppercase;
            text-align: center;
            margin: 15px 0;
        }
        h2 {
            font-size: 14pt;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
        }
        h3 {
            font-size: 12pt;
            font-weight: bold;
            margin-top: 20px;
        }
        h4 {
            font-size: 11pt;
            font-weight: bold;
            text-decoration: underline;
            margin-top: 15px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            table-layout: fixed;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            font-size: 11pt;
            overflow-wrap: break-word;
            text-align: center;
            vertical-align: middle;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        .signature img {
            max-height: 20mm;
            width: auto;
        }
        .bold { font-weight: bold; }
        .italic { font-style: italic; }
        .section {
            margin-bottom: 20px;
            padding-bottom: 20px; /* Espace pour éviter le chevauchement */
        }
        .page {
            page-break-after: always;
        }
        .page:last-child {
            page-break-after: auto;
        }
        .footer {
            text-align: center;
            margin-top: 10px;
            width: 100%;
        }
        .footer img {
            width: 100%;
            height: auto;
            max-height: 100px; /* Pied de page agrandi */
        }
        .avis-section {
            border: 1px solid black;
            padding: 10px;
            margin-bottom: 20px;
        }
        .avis-text {
            min-height: 50px;
            border-bottom: 1px dashed black;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    {% load evaluation_filters %}
    <div class="container">
        <div class="page">
            <div class="header">
                <img src="{{ entete_path }}" alt="ANStat En-tête">
            </div>
            <div class="section">
                <h1>FICHE D’ÉVALUATION DES AGENTS</h1>
                <h1>ANNÉE {{ evaluation.annee }} (Semestre {{ evaluation.semestre }})</h1>
                <h2>I. IDENTIFICATION DU SALARIÉ</h2>
                <p>(À renseigner par le Service du Personnel)</p>
                <table>
                    <colgroup>
                        <col style="width: 40%;">
                        <col style="width: 60%;">
                    </colgroup>
                    <tr>
                        <td class="bold" style="text-align: left; padding: 10px;">Nom et Prénoms :</td>
                        <td style="text-align: left; padding: 10px;">{{ agent.nom }} {{ agent.prenoms }}</td>
                    </tr>
                    <tr>
                        <td class="bold" style="text-align: left; padding: 10px;">Matricule :</td>
                        <td style="text-align: left; padding: 10px;">{{ agent.matricule }}</td>
                    </tr>
                    <tr>
                        <td class="bold" style="text-align: left; padding: 10px;">Date d’embauche :</td>
                        <td style="text-align: left; padding: 10px;">{{ agent.date_embauche|date:"d/m/Y" }}</td>
                    </tr>
                    <tr>
                        <td class="bold" style="text-align: left; padding: 10px;">Catégorie :</td>
                        <td style="text-align: left; padding: 10px;">{{ agent.categorie|default:"N/A" }}</td>
                    </tr>
                    <tr>
                        <td class="bold" style="text-align: left; padding: 10px;">Direction :</td>
                        <td style="text-align: left; padding: 10px;">{{ agent.direction.nom }}</td>
                    </tr>
                    <tr>
                        <td class="bold" style="text-align: left; padding: 10px;">Sous-Direction :</td>
                        <td style="text-align: left; padding: 10px;">{{ agent.sous_direction|default:"N/A" }}</td>
                    </tr>
                    <tr>
                        <td class="bold" style="text-align: left; padding: 10px;">Service :</td>
                        <td style="text-align: left; padding: 10px;">{{ agent.service|default:"N/A" }}</td>
                    </tr>
                </table>
            </div>

            <div class="section">
                <h2>II. IDENTIFICATION DU POSTE DU SALARIÉ</h2>
                <p>(À renseigner par le titulaire du poste)</p>
                <table>
                    <colgroup>
                        <col style="width: 40%;">
                        <col style="width: 60%;">
                    </colgroup>
                    <tr>
                        <td class="bold" style="text-align: left; padding: 10px;">Poste :</td>
                        <td style="text-align: left; padding: 10px;">{{ agent.poste|default:"N/A" }}</td>
                    </tr>
                    <tr>
                        <td class="bold" style="text-align: left; padding: 10px;">Tenu depuis le :</td>
                        <td style="text-align: left; padding: 10px;">{{ agent.tenu_depuis|date:"d/m/Y"|default:"N/A" }}</td>
                    </tr>
                </table>
            </div>

            <div class="section">
                <h2>III. ÉVALUATION DU RENDEMENT ET DU COMPORTEMENT</h2>
                <p>L’évaluateur dispose des standards de notation définis comme suit :</p>
                <p class="italic">1 = Très insuffisant, 2 = Insuffisant, 3 = Assez Bon, 4 = Bon, 5 = Très Bon</p>

            </div>
            <div class="section">
                <p> </p>
                <p> </p>
            </div>
        </div>

        <div class="page">
            <div class="section">
                <h3>A. Évaluation du rendement</h3>
                <table>
                    <div style="page-break-before: always;"></div>
                    <tr>
                        <th>Critères de rendement</th>
                        <th>Notation du Directeur ou du Responsable de structure</th>
                    </tr>
                    <tr>
                        <td style="text-align: left; padding: 10px;">Connaissances et aptitudes professionnelles</td>
                        <td>{{ evaluation.connaissances }}</td>
                    </tr>
                    <tr>
                        <td style="text-align: left; padding: 10px;">Esprit d’initiative</td>
                        <td>{{ evaluation.initiative }}</td>
                    </tr>
                    <tr>
                        <td style="text-align: left; padding: 10px;">Puissance du travail et rendement</td>
                        <td>{{ evaluation.rendement }}</td>
                    </tr>
                    <tr>
                        <td style="text-align: left; padding: 10px;">Respect des objectifs</td>
                        <td>{{ evaluation.respect_objectifs }}</td>
                    </tr>
                    <tr>
                        <td class="bold">Total Notes</td>
                        <td>{{ evaluation.connaissances|add:evaluation.initiative|add:evaluation.rendement|add:evaluation.respect_objectifs }}</td>
                    </tr>
                    <tr>
                        <td class="bold">Moyenne (M1) = Total / 4</td>
                        <td>{{ evaluation.moyenne_rendement|floatformat:3 }}</td>
                    </tr>
                </table>
            </div>

            <div class="section">
                <h3>B. Évaluation du Comportement</h3>
                <table>
                    <tr>
                        <th>Critères de comportement</th>
                        <th>Notation du Directeur ou du Responsable de structure</th>
                    </tr>
                    <tr>
                        <td style="text-align: left; padding: 10px;">Civisme, intégrité et moralité</td>
                        <td>{{ evaluation.civisme }}</td>
                    </tr>
                    <tr>
                        <td style="text-align: left; padding: 10px;">Sens du service public</td>
                        <td>{{ evaluation.service_public }}</td>
                    </tr>
                    <tr>
                        <td style="text-align: left; padding: 10px;">Sens social et sens des relations humaines (Esprit d’équipe)</td>
                        <td>{{ evaluation.relations_humaines }}</td>
                    </tr>
                    <tr>
                        <td style="text-align: left; padding: 10px;">Esprit de discipline</td>
                        <td>{{ evaluation.discipline }}</td>
                    </tr>
                    <tr>
                        <td style="text-align: left; padding: 10px;">Ponctualité</td>
                        <td>{{ evaluation.ponctualité }}</td>
                    </tr>
                    <tr>
                        <td style="text-align: left; padding: 10px;">Assiduité</td>
                        <td>{{ evaluation.assiduite }}</td>
                    </tr>
                    <tr>
                        <td style="text-align: left; padding: 10px;">Tenue vestimentaire et présentation</td>
                        <td>{{ evaluation.tenue }}</td>
                    </tr>
                    <tr>
                        <td class="bold">Total</td>
                        <td>{{ evaluation.civisme|add:evaluation.service_public|add:evaluation.relations_humaines|add:evaluation.discipline|add:evaluation.ponctualité|add:evaluation.assiduite|add:evaluation.tenue }}</td>
                    </tr>
                    <tr>
                        <td class="bold">Moyenne (M2) = Total / 7</td>
                        <td>{{ evaluation.moyenne_comportement|floatformat:3 }}</td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="page">
            <div class="section">
                <h4>C. Note Finale S{{ evaluation.semestre }} / 5</h4>
                <table>
                    <colgroup>
                        <col style="width: 35%;">
                        <col style="width: 20%;">
                        <col style="width: 15%;">
                        <col style="width: 30%;">
                    </colgroup>
                    <thead>
                        <tr style="background-color: #f2f2f2;">
                            <th>Moyennes</th>
                            <th>Moy. / 5</th>
                            <th>Coeff.</th>
                            <th>Moy. pond. (MP)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="text-align: left; padding: 10px;">Moy. éval. rendement (M1)</td>
                            <td>{{ evaluation.moyenne_rendement|floatformat:3 }}</td>
                            <td>2</td>
                            <td>{{ evaluation.mp1|floatformat:3 }} / 10</td>
                        </tr>
                        <tr>
                            <td style="text-align: left; padding: 10px;">Moy. éval. comportement (M2)</td>
                            <td>{{ evaluation.moyenne_comportement|floatformat:3 }}</td>
                            <td>1</td>
                            <td>{{ evaluation.mp2|floatformat:3 }} / 5</td>
                        </tr>
                        <tr style="background-color: #e0e0e0; font-weight: bold;">
                            <td style="text-align: left; padding: 10px;">Total Moy. : Somme (MP1+MP2)</td>
                            <td></td>
                            <td>3</td>
                            <td>{{ evaluation.somme_moyennes_ponderees|floatformat:3 }} / 15</td>
                        </tr>
                        <tr>
                            <td colspan="3" style="text-align: center; font-weight: bold;">Moyenne Générale S{{ evaluation.semestre }} / 3</td>
                            <td>{{ evaluation.moyenne_generale|floatformat:3 }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="section">
                <div class="avis-section">
                    <h3 style="text-align: center; font-weight: bold;">Avis du Directeur ou du Responsable de structure</h3>
                    <p style="text-align: center;">{{ evaluation.avis_directeur|default:"" }}</p>
                    {% if signature_path %}
                        <p>Signature :</p>
                        <div class="signature">
                            <img src="{{ signature_path }}" alt="Signature du Directeur" style="max-height:20mm; width:auto; display:block; margin:4px auto;">
                        </div>
                    {% endif %}
                </div>
            </div>
            <div class="section">
                <div class="avis-section">
                    <h3 style="text-align: center; font-weight: bold;">Avis de l'agent évalué et projet professionnel</h3>
                    <p class="avis-text" style="text-align: center;">{{ evaluation.avis_agent|default:"" }}</p>
                    {% if signature_agent_path %}
                        <p>Signature :</p>
                        <div class="signature">
                            <img src="{{ signature_agent_path }}" alt="Signature de l'agent" style="max-height:20mm; width:auto; display:block; margin:4px auto;">
                        </div>
                    {% endif %}
                    <p>Date : {{ evaluation.date_signature_agent|date:"d/m/Y" }}</p>
                </div>
            </div>

            <div class="section">
                <h3>IV. DÉCISION FINALE DU DIRECTEUR GÉNÉRAL OU SON REPRÉSENTANT</h3>
                <table>
                    <tr>
                        <td style="text-align: left; padding: 10px;">{% if evaluation.decision_formation %}☑{% else %}☐{% endif %} Formation</td>
                    </tr>
                    <tr>
                        <td style="text-align: left; padding: 10px;">{% if evaluation.decision_promotion %}☑{% else %}☐{% endif %} Promotion</td>
                    </tr>
                    <tr>
                        <td style="text-align: left; padding: 10px;">{% if evaluation.decision_augmentation %}☑{% else %}☐{% endif %} Augmentation de salaire (au mérite)</td>
                    </tr>
                    <tr>
                        <td style="text-align: left; padding: 10px;">{% if evaluation.decision_rupture %}☑{% else %}☐{% endif %} Rupture de contrat</td>
                    </tr>
                    <tr>
                        <td style="text-align: left; padding: 10px;">{% if evaluation.decision_autres %}☑{% else %}☐{% endif %} Autres décisions : {{ evaluation.decision_autres|default:"" }}</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</body>
</html>